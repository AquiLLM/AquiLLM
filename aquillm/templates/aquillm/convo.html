{% extends "aquillm/base.html" %}

{% block title %}Conversation{% endblock %}

{% block content %}
<div id="conversation-container"></div>
<form id="message-form" action="{% url 'send_message' convo_id %}" method="post">
    {% csrf_token %}
    {{ form }}
    <input type="submit" value="Submit">
</form>
{% endblock %}

{% block scripts %}
<script>
    function loadConversation() {
        fetch("{% url 'raw_convo' convo_id %}")
            .then(response => response.text())
            .then(data => {
                document.getElementById("conversation-container").innerHTML = data;
            });
    }
    document.addEventListener("DOMContentLoaded", function() {
        loadConversation();
        document.getElementById("message-form").addEventListener("submit", function(e) {
            loadConversation();
        });
    });
</script>
{% endblock %}